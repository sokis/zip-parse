"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.e:e}function znorm(e){return e.replace(/\\/g,"/")}function zjoin(e,r){return znorm(path__default.join(e,r))}function _readFileSync(e,r){var t=this.r[e];if(!t)return fs.t(e,r);var n=new Buffer(FH_SIZE);this.n(n,t.a);var a=this.i(t,n),i=new Buffer(t.u),u=this.n(i,a);assert.s(u,i.length);var s=void 0;if(0===t.c)s=i;else{if(8!==t.c)throw Error("Unsupported compression method "+t.c);s=zlib.f(i)}return r?s.toString(r):s}function _statSync(e){if(!this.o(e))return fs.o(e);var r=this.r[e];return Object.assign({l:function(){return r.y},d:function(){return!r.y}},r)}function _stat(e,r){try{var t=this._(e);r&&r(null,t)}catch(e){r&&r(e)}}function _readFile(e,r,t){var n=this,a=this.r[e];if(!a)return"function"==typeof r&&(t=r,r=null),fs.h(e,r,t);var i=new Buffer(FH_SIZE);this.v(i,a.a,function(){var e=n.i(a,i),r=new Buffer(a.u);n.v(r,e,function(e,n){assert.s(n,r.length),0===a.c?t(null,r):8===a.c&&zlib.p(r,t)})})}function _filter(e){var r=[];for(var t in this.r){var n=this.r[t];e(t,n)&&r.push(n)}return r}function _ref$1(e){return path__default.S(e.name)}function _readdir(e,r){e=zjoin(e,"/");var t=this.filter(function(r,t){var n=r.indexOf("/",e.length);return 0===r.indexOf(e)&&r!==e&&(-1===n||n==r.length-1)}).map(_ref$1);return r&&r(null,t),t}function _readdirSync(e){return this.C(e)}function _realpathSync(e){return zjoin(this.D,e)}function _getDataOffset2(e,r){assert.s(r.k(0,4),FH_SIGN,"Couldn't find file signature");var t=r.k(26,2),n=r.k(28,2);return e.a+r.length+t+n}function _readSync2(e,r){return e.length?readSync(this.z,e,0,e.length,r):0}function _readAsync2(e,r,t){if(e.length)return readAsync(this.z,e,0,e.length,r,t);t(null,0,e)}function _readCDEntry2(e,r){function t(t,n){return e.k(r+t,n)}assert.s(t(0,4),CDE_SIGN,"Couldn't find CD signature");var n=t(28,2),a=r+CDE_SIZE,i=t(30,2),u=t(32,2),s=e.toString(void 0,a,a+n),c={name:s,c:t(10,2),u:t(20,4),g:t(24,4),a:t(42,4)};return c.y="/"==s.substr(-1),c.y&&(this.r[c.name.substr(0,c.name.length-1)]=c),this.r[c.name]=c,CDE_SIZE+n+i+u}function _getCD2(){var e=new Buffer(EOCD_SIZE);this.n(e,this.F-e.length),assert.s(e.k(0,4),EOCD_SIGN,"Couldn't find EOCD signature");var r=e.k(12,4),t=e.k(16,4),n=new Buffer(r),a=this.n(n,t);return assert.s(a,r),{I:e.k(10,2),Z:n}}function _loadCD2(){for(var e=this.O(),r=0,t=0;t<e.I;t++)r+=this.j(e.Z,r)}function _close(){closeSync(this.z)}function _exists(e){return e in this.r}function _existsSync(e){return this.w(e)}function getZip(e){e=znorm(e);var r=ZIP_CACHE[e];if(r)return r;var t=new Archive(e);return ZIP_CACHE[e]=t,t}function parseZipPath(e){var r=e.indexOf(".zip");return-1!=r&&{x:znorm(e.substr(0,r+4)),P:znorm(e.substr(r+5))}}function hasOwnProperty(e,r){return Object.prototype.hasOwnProperty.call(e,r)}function readPackage(e,r){if(hasOwnProperty(packageMainCache,r))return packageMainCache[r];var t=zjoin(r,"package.json"),n=void 0,a=void 0;try{n=e.t(t,"utf8")}catch(e){return!1}try{a=packageMainCache[r]=JSON.parse(n).m}catch(e){throw e.D=t,e.message="Error parsing "+t+": "+e.message,e}return a}function tryFile(e,r){try{var t=e._(r);if(t&&!t.l())return e.M(r,Module.A)}catch(e){}return!1}function tryExtensions(e,r,t){for(var n=0;n<t.length;n++){var a=tryFile(e,r+t[n]);if(a)return a}return!1}function tryPackage(e,r,t){var n=readPackage(e,r);if(!n)return!1;var a=zjoin(r,n);return tryFile(e,a)||tryExtensions(e,a,t)||tryExtensions(e,zjoin(a,"index"),t)}function _ref(e){var r=fs[e];fs[e]=function(t,n,a){var i=(t=path.b(t)).indexOf(".zip"),u=t.indexOf("package.json");if(-1!==u&&u-5===i&&(i=(t=t.substr(0,i-5)+t.substr(u-1)).indexOf(".zip")),-1==i)return r.apply(fs,arguments);var s=parseZipPath(t);return getZip(s.x)[e](znorm(s.P),n,a)}}var fs=_interopDefault(require("fs")),path=require("path"),path__default=_interopDefault(path),Module=_interopDefault(require("module")),assert=_interopDefault(require("assert")),zlib=_interopDefault(require("zlib")),classCallCheck=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.H=n.H||!1,n.N=!0,"value"in n&&(n.q=!0),Object.defineProperty(e,n.B,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),openSync=fs.G,closeSync=fs.J,statSync=fs._,readSync=fs.$,readAsync=fs.T,FH_SIZE=30,FH_SIGN=67324752,EOCD_SIZE=22,EOCD_SIGN=101010256,CDE_SIZE=46,CDE_SIGN=33639248,Archive=function(){function e(r){classCallCheck(this,e),this.D=r,this.z=openSync(r,"r"),this.F=statSync(r).U,this.r={},this.K()}return createClass(e,[{B:"readFileSync",L:_readFileSync},{B:"statSync",L:_statSync},{B:"stat",L:_stat},{B:"readFile",L:_readFile},{B:"filter",L:_filter},{B:"readdir",L:_readdir},{B:"readdirSync",L:_readdirSync},{B:"realpathSync",L:_realpathSync},{B:"_getDataOffset",L:_getDataOffset2},{B:"_readSync",L:_readSync2},{B:"_readAsync",L:_readAsync2},{B:"_readCDEntry",L:_readCDEntry2},{B:"_getCD",L:_getCD2},{B:"_loadCD",L:_loadCD2},{B:"close",L:_close},{B:"exists",L:_exists},{B:"existsSync",L:_existsSync}]),e}(),zipParse=function(e){return new Archive(e)},ZIP_CACHE={},packageMainCache={};["readFileSync","readFile","readdirSync","readdir","statSync","stat","realpathSync","existsSync"].forEach(_ref),function(){var e=Module.Q;Module.Q=function(r,t){var n=e.apply(module,arguments);if(n)return n;var a=Object.keys(Module.R);"/"===r.charAt(0)&&(t=[""]);var i="/"===r.slice(-1),u=JSON.V({W:r,X:t});if(Module.Y[u])return Module.Y[u];for(var s=0,c=t.length;s<c;s++){var f=parseZipPath(path.b(t[s],r));if(f){var o=getZip(f.x),l=void 0;if(i||(l=tryFile(o,f.P))||(l=tryExtensions(o,f.P,a)),l||(l=tryPackage(o,f.P,a)),l||(l=tryExtensions(o,zjoin(f.P,"index"),a)),l)return Module.Y[u]=l,l}}return!1}}(),module.ee=zipParse;
